---
title: "Run_A_Day"
author: "Emmett & Rachel"
format: pdf
editor: visual
---

## Running a Singular Day

##### This will allow the simulation to replicate and find sample statistics for the optimization.

```{r}
#load libraries
library(tidyverse)
```

NOTE: THIS CODE CHUNK IS NOT FOR INCLUSION IN FINAL FUNCTION. THIS IS FOR CURRENT WORKING DOCUMENT, SO THAT WE HAVE REASONABLE INPUT DATAFRAMES TO WORK FROM IN THE MEANTIME.

```{r}
#create dummy arrival rates data set 
bike_data<-read.csv('/Users/juliadubnoff/Downloads/sample_bike.csv')
bike_data<-bike_data_clean(bike_data)
arrival_rates<-arrival_rates(bike_data)


#create dummy bike placement data set
bike_placement<-bike_data%>%
  group_by(end_station)%>%
  summarize(bikes_to_start=5)%>%
  rename(station=end_station)
  

```

**Function:**

```{r}

  lambda_max_dummy<-arrival_rates%>%
    group_by(start_station, end_station)%>%
    summarize(lambda_max=max(mu_hat))
  
  
run_a_day <- function(arrival_rates_df, bike_placement){
  
  simulated_arrivals <- arrival_rates_df %>%
    #sort by start and end stations so to create samples based on each pair
    group_by(start_station, end_station) %>%
    #find lambda_max, the maximum arrival rate observed, for each pair of stations
    summarize(lambda_max=max(mu_hat)) %>%
    #initialize number of arrivals per hour in simulation
    mutate(arrivals_inital_sim=0)
    
  
    #for each pair of start and end stations, create an exponential sample based on lambda_max. 
    
    #cycle through each row in the the max_arrival_rates_df. This will allow us to index the lambda_max of each particular row
  
    for(i in 1:nrow(simulated_arrivals)) {
      
      #create data frame sample_arrivals which will store arrival number and time, as well as the total time since the start of the day
      sample_arrivals <- data.frame("arrival_number" = c(), "arrival_time"=c(), "total_time" =c())
      
      #initialize time variable, counting number of hours since the day started. once 24 hours have passed, the day is complete.
      total_time <- 0
      
      #initialize the index, add 1 after each round
      index <- 0
    
      #calculate rate of arrival for each minute 
      while (total_time <= 24) {
        
        #find the arrival time for this observation
        this_arrival_time <- rexp(1, rate = simulated_arrivals$lambda_max[i])
        
        #add one to the index
        index <- index + 1
        
        #update total time 
        total_time <- total_time + this_arrival_time
        
        #determine whether or not to keep with thinning
        simulated_time_output <- thinning(total_time, arrival_rates_df)
        
        
        
        
        #store data in sample_arrivals
        new_entry <- data.frame("arrival_number" = index, "arrival_time" = this_arrival_time, "total_time" = total_time)
        sample_arrivals<-rbind(sample_arrivals, new_entry)
        
      }
    
    
    #how do I output this???
    
    }

  
  
  return(unhappy_customers, times_unstocked)
  

}





```
