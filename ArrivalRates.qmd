---
title: "Arrival Rates"
author: "Emmett & Rachel"
format: pdf
editor: visual
---

Arrival Rates

```{r}
#load libraries 
library(tidyverse)
```

```{r}
#'Average Arrival Rates for Bike Share Program 
#' @description uses the data and models a non-homogeneous Poisson process
#'  to calculate the average arrival rates in hour h from each pair
#'  of starting and ending stations. 
#' @param cleaned_bike_df cleaned data frame of starting stations (start_station), destination stations (end_station), and hour of bike arrivals (end_time). Each observation is one bike trip from a start_station to an end_station.
#' @return res data frame of estimated average arrival rates (x_hat) for every combination of hour (h), start_station (s), and end_station (t).

arrival_rates <- function(cleaned_bike_df){
  x_hat_df <- cleaned_bike_df %>%
    #add a column for day
    mutate(day = day(end_time))
  #find the number of days in the data
  n_days <- length(unique(bike_df$day))
  
  res <- x_hat_df %>% 
    #add a column for hour
    mutate(hour =  hour(end_time)) %>%
    #group by the the parameters of interest (h, s, t as hour, start_station, end_station)
    group_by(hour, start_station, end_station) %>%
    #calculate the x_hat
    summarize(x_hat = n()/n_days)
  return(res)
}
```
